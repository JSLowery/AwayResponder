<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, September 16, 2016, 7:50 AM -->
<!-- MuClient version 4.98 -->

<!-- Plugin "AwayResponder" generated by Plugin Wizard -->

<muclient>
<plugin
   name="AwayResponder"
   author="Sonet"
   id="c53772399b2b48a9301d971d"
   language="Lua"
   purpose="Replies to tells when your away for to long"
   save_state="y"
   date_written="2016-09-16 07:47:56"
   requires="4.98"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   match="^(.*) just sent you a tell\.$"
   regexp="y"
   enabled="y"
   send_to="14"
   sequence="100"
   script="CheckTime"
  >
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
require "serialize"
require "tprint"
local time 
local CharName
function CheckTime(name, line, wildcards)
  local thisTime = os.time()
  local diff = thisTime - time
  local diffmin = math.floor(diff/60)
  res, gmcparg = CallPlugin("3e7dedbe37e44942dd46d264","gmcpval","char.base")
        luastmt = "gmcpdatacharstatus = " .. gmcparg
        assert (loadstring (luastmt or "")) ()
        --tprint (gmcpdatacharstatus)
        --print(gmcpdatacharstatus.name)
        CharName = gmcpdatacharstatus.name
  --print (diff)
  --print (diffmin)
  if (diffmin >=5) then
    
    Send("reply I am sorry "..wildcards[1].. ", "..CharName.." has not typed anything in ".. diffmin.." minutes. They are not here most likely.")
  end
  --print(diff)
end
function OnPluginCommand(bob) -- this doesn't work, its not in a plugin yet
time = os.time()

--print (time)
 --print (bob)
end 

function OnPluginInstall()

end
]]>
</script>


</muclient>
