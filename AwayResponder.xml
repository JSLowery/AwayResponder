<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, September 16, 2016, 7:50 AM -->
<!-- MuClient version 4.98 -->

<!-- Plugin "AwayResponder" generated by Plugin Wizard -->

<muclient>
<plugin
   name="AwayResponder"
   author="Sonet"
   id="c53772399b2b48a9301d971d"
   language="Lua"
   purpose="Replies to tells when your away for to long"
   save_state="y"
   date_written="2016-09-16 07:47:56"
   requires="4.98"
   version="1.0"
   >

</plugin>


<!--  Get our standard constants -->

<include name="constants.lua"/>

<!--  Triggers  -->

<triggers>
  <trigger
   match="^(.*) just sent you a tell\.$"
   regexp="y"
   enabled="y"
   send_to="14"
   sequence="100"
   script="CheckTime"
  >
  </trigger>
</triggers>

<!--  Script  -->


<script>
<![CDATA[
require "serialize"
require "tprint"
local time 
local CharName
function CheckTime(name, line, wildcards)
  local thisTime = os.time()
  local diff = thisTime - time
  local diffmin = math.floor(diff/60)
  res, gmcparg = CallPlugin("3e7dedbe37e44942dd46d264","gmcpval","char.base")
        luastmt = "gmcpdatacharstatus = " .. gmcparg
        assert (loadstring (luastmt or "")) ()
        --tprint (gmcpdatacharstatus)
        --print(gmcpdatacharstatus.name)
        CharName = gmcpdatacharstatus.name
  --print (diff)
  --print (diffmin)
  if last_person == wildcards[1] then
    return
  end
  last_person = wildcards[1]

  if (diffmin >=5) then
    if math.floor(diffmin/60)==1 then
      Send("reply I am sorry "..wildcards[1].. ", "..CharName.." has not typed anything in "..
      math.floor(diffmin/60).." hour and ".. (diffmin-(math.floor(diffmin/60)*60))..
      " minutes. They are not here most likely.")
    elseif math.floor(diffmin/60)>1 then
      Send("reply I am sorry "..wildcards[1].. ", "..CharName.." has not typed anything in "..
      math.floor(diffmin/60).." hours and ".. (diffmin-(math.floor(diffmin/60)*60))..
      " minutes. They are not here most likely.")
    elseif math.floor(diffmin/60)==0 then
      Send("reply I am sorry "..wildcards[1].. ", "..CharName.." has not typed anything in "..
      (diffmin-(math.floor(diffmin/60)*60))..
      " minutes. They are not here most likely.")
    end
  end
  --print(diff)
end
function OnPluginCommand(bob) 
  if bob == "where1" or string.find(bob, "cast") or string.find(bob, "swho 12 area") or string.find(bob, "shadow")
  or string.find(bob, 'sl') or string.find(bob, 'con all')
  or string.find(bob, 'heighten') or string.find(bob, 'hide') or (string.find(bob, '\n') and bob:len() ==1) then return end
time = os.time()

--print (time)
 print ('reset on',bob)
end 

function OnPluginInstall()

end
]]>
</script>


</muclient>
